<header>
  <app-header-admin></app-header-admin>
</header>

<div class="container mt-5">
  <!-- Navigation Tabs -->
  <ul class="nav nav-tabs" role="tablist">
    <li class="nav-item">
      <a class="nav-link" [class.active]="activeTab === 'crear'" (click)="setActiveTab('crear')" role="tab">Crear/Modificar Afiliado</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" [class.active]="activeTab === 'lista'" (click)="setActiveTab('lista')" role="tab">Lista de Afiliados</a>
    </li>
  </ul>

  <!-- Tab Content -->
  <div class="tab-content mt-3">
    <!-- Create/Modify Affiliate Tab -->
    <div *ngIf="activeTab === 'crear'" class="tab-pane active">
      <h2 class="mb-4">Crear/Modificar Afiliado</h2>

      <form [formGroup]="afiliadoForm" (ngSubmit)="saveAfiliado()">
        <div class="form-group mb-3">
          <label for="cedula_juridica">Cédula Jurídica</label>
          <input formControlName="cedula_juridica" id="cedula_juridica" class="form-control" placeholder="Cédula Jurídica" />
        </div>

        <div class="form-group mb-3">
          <label for="nombre">Nombre del Comercio</label>
          <input formControlName="nombre" id="nombre" class="form-control" placeholder="Nombre del Comercio" />
        </div>

        <div class="form-group mb-3">
          <label for="id_tipo">Tipo de Comercio</label>
          <select formControlName="id_tipo" id="id_tipo" class="form-control">
            <option value="">Seleccione un tipo</option>
            <option *ngFor="let tipo of tipos_comercio" [value]="tipo.ID">
              {{tipo.nombre}}
            </option>
          </select>
        </div>

        <div class="form-group mb-3">
          <label for="correo">Correo Electrónico</label>
          <input type="email" formControlName="correo" id="correo" class="form-control" placeholder="Correo Electrónico" />
        </div>

        <div class="form-group mb-3">
          <label for="SINPE">Número SINPE Móvil</label>
          <input formControlName="SINPE" id="SINPE" class="form-control" placeholder="Número SINPE Móvil" />
        </div>

        <div class="form-group mb-3">
          <label for="cedula_admin">Administrador</label>
          <select formControlName="cedula_admin" id="cedula_admin" class="form-control">
            <option value="">Seleccione un administrador</option>
            <option *ngFor="let admin of administradores" [value]="admin.cedula">
              {{admin.nombre}} {{admin.apellido1}} ({{admin.cedula}})
            </option>
          </select>
        </div>

        <div class="form-group mb-3">
          <label for="provincia">Provincia</label>
          <input formControlName="provincia" id="provincia" class="form-control" placeholder="Provincia" />
        </div>

        <div class="form-group mb-3">
          <label for="canton">Cantón</label>
          <input formControlName="canton" id="canton" class="form-control" placeholder="Cantón" />
        </div>

        <div class="form-group mb-3">
          <label for="distrito">Distrito</label>
          <input formControlName="distrito" id="distrito" class="form-control" placeholder="Distrito" />
        </div>


        <!-- Teléfonos -->
        <div formArrayName="TelefonosComercio" class="form-group mb-3">
          <label>Teléfonos</label>
          <div *ngFor="let telefono of telefonos.controls; let i = index" [formGroupName]="i" class="telefono-container">
            <div class="telefono-grupo">
              <input
                id="telefono{{i}}"
                type="text"
                formControlName="telefono"
                class="form-control"
                placeholder="Número de Teléfono {{i+1}}"
              >
              <button
                *ngIf="telefonos.length > 1"
                type="button"
                class="btn btn-danger"
                (click)="removeTelefonoRegister(i)"
              >
                Eliminar
              </button>
            </div>
          </div>
          <button type="button" class="btn btn-secondary mb-3" (click)="addTelefonoRegister()">
            Agregar Teléfono
          </button>
        </div>

        <div class="form-group text-center mt-4">
          <button type="submit" class="btn btn-primary btn-lg">
            {{editMode ? 'Actualizar' : 'Guardar'}} Afiliado
          </button>
        </div>
      </form>
    </div>

    <!-- Affiliate List Tab -->
    <div *ngIf="activeTab === 'lista'" class="tab-pane active">
      <h2 class="mb-4">Lista de Afiliados</h2>

      <div class="afiliados-container">
        <div class="card mb-3" *ngFor="let afiliado of afiliados">
          <div class="card-body">
            <div class="row">
              <div class="col-md-8">
                <h5 class="card-title">{{afiliado.nombre}}</h5>
                <p class="card-text">Cédula Jurídica: {{afiliado.cedula_juridica}}</p>
                <p class="card-text">Correo: {{afiliado.correo}}</p>
                <p class="card-text">SINPE Móvil: {{afiliado.SINPE}}</p>

                <p class="card-text" *ngIf="getAdminByCedula(afiliado.cedula_admin)">
                  Administrador:
                  {{ getAdminByCedula(afiliado.cedula_admin)?.nombre }}
                  {{ getAdminByCedula(afiliado.cedula_admin)?.apellido1 }}
                  ({{ afiliado.cedula_admin }})
                </p>
                 <!-- Mostrar la dirección específica de acuerdo a la cédula -->
              <p class="card-text" *ngIf="getDireccionByCedula(afiliado.cedula_juridica)">
                Provincia: {{ getDireccionByCedula(afiliado.cedula_juridica)?.provincia }}
              </p>
              <p class="card-text" *ngIf="getDireccionByCedula(afiliado.cedula_juridica)">
                Cantón: {{ getDireccionByCedula(afiliado.cedula_juridica)?.canton }}
              </p>
              <p class="card-text" *ngIf="getDireccionByCedula(afiliado.cedula_juridica)">
                Distrito: {{ getDireccionByCedula(afiliado.cedula_juridica)?.distrito }}
              </p>

                <!-- Teléfonos -->
                <div class="telefonos-info">
                  <h6>Teléfonos:</h6>
                  <ul class="list-unstyled">
                    <li *ngFor="let telefono of getTelefonosByCedula(afiliado.cedula_juridica)">
                      {{telefono.telefono}}
                    </li>
                  </ul>
                </div>
              </div>

              <div class="col-md-4 d-flex flex-column justify-content-center">
                <button class="btn btn-warning mb-2" (click)="editAfiliado(afiliado.cedula_juridica)">
                  Actualizar
                </button>
                <button class="btn btn-danger" (click)="deleteAfiliado(afiliado.cedula_juridica)">
                  Eliminar
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
